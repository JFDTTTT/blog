# 正则表达式的拆分

## 结构和操作符

结构：

| 结构   | 说明                                                                                                                                                                                                    |
| ------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 字面量 | 匹配一个具体字符，包括不用转义的和需要转义的。比如 a 匹配字符 "a"， 又比如 \n 匹配换行符，又比如 \. 匹配小数点。                                                                                        |
| 字符组 | 匹配一个字符，可以是多种可能之一，比如 [0-9]，表示匹配一个数字。也有 \d 的简写形式。 另外还有反义字符组，表示可以是除了特定字符之外任何一个字符，比如 [^0-9]， 表示一个非数字字符，也有 \D 的简写形式。 |
| 量词   | 表示一个字符连续出现，比如 a{1,3} 表示 "a" 字符连续出现 3 次。 另外还有常见的简写形式，比如 a+ 表示 "a" 字符连续出现至少一次。                                                                          |
| 锚     | 匹配一个位置，而不是字符。比如 ^ 匹配字符串的开头，又比如 \b 匹配单词边界， 又比如 (?=\d) 表示数字前面的位置。                                                                                          |
| 分组   | 用括号表示一个整体，比如 (ab)+，表示 "ab" 两个字符连续出现多次， 也可以使用非捕获分组 (?:ab)+。                                                                                                         |
| 分支   | 多个子表达式多选一，比如 abc                                                                                                                                                                            | bcd，表达式匹配 "abc" 或者 "bcd" 字符子串。 反向引用，比如 \2，表示引用第 2 个分组。 |

操作符：

| 描述         | 操作符                                    | 优先级 |
| ------------ | ----------------------------------------- | ------ |
| 转义符       | `\` | 1                                   |
| 括号和方括号 | `(...)、(?:...)、(?=...)、(?!...)、[...]` | 2      |
| 量词限定符   | `{m}、{m,n}、{m,}、?、*、+`               | 3      |
| 位置和序列   | `^、$、\元字符、一般字符`                 | 4      |
| 管道符(竖杠) | `\|`                                      | 5      |

我们来分析一个正则，熟悉一下：`/ab?(c|de*)+|fg/`

- 由于括号的存在，所以，`(c|de*)` 是一个整体结构。
- 在 `(c|de*)` 中，注意其中的量词 ，因此 `e` 是一个整体结构。
- 又因为分支结构 `|` 优先级最低，因此 `c` 是一个整体、而 `de*` 是另一个整体。
- 同理，整个正则分成了 `a、b?、(...)+、f、g`。而由于分支的原因， 又可以分成 `ab?(c|de*)+` 和 `fg` 这两部分。

<img :src="$withBase('/img/regex/image1.png')">

## 注意要点

### 匹配字符串整体问题

因为是要匹配整个字符串，我们经常会在正则前后中加上锚 `^` 和 `$`。

比如要匹配目标字符串 "abc" 或者 "bcd" 时，如果一不小心，就会写成 `/^abc|bcd$/`。

<img :src="$withBase('/img/regex/image2.png')">

应该修改成: `/^(abc|bcd)$/`

<img :src="$withBase('/img/regex/image3.png')">

### 量词连缀问题

要求：

- 每个字符为 "a、"b"、"c" 任选其一，
- 字符串的长度是 3 的倍数。

错误：`/^[abc]{3}+$/` 正确: `/^([abc]{3})+$/`

### 元字符转义问题

所谓元字符，就是正则中有特殊含义的字符。

所有结构里，用到的元字符总结如下:

```
^、$、.、*、+、?、|、\、/、(、)、[、]、{、}、=、!、:、-
```

当匹配字符本身时，可使用 `\` 转义

```javascript
var string = "^$.*+?|\\/[]{}=!:-,";
var regex = /\^\$\.\*\+\?\|\\\/\[\]\{\}\=\!\:\-\,/; 
console.log( regex.test(string) );
// true
```

### 小结

这里稍微总结一下，竖杠的优先级最低，即最后运算。 只要知道这一点，就能读懂大部分正则。 

:::tip
另外关于元字符转义问题，当自己不确定与否时，尽管去转义，总之是不会错的。
:::
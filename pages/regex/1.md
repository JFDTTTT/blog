# 字符串匹配攻略

::: tip
正则表达式是匹配模式，要么匹配字符，要么匹配位置。 请记住这句话
:::

[regexr](https://regexr.com/): 小网站加持

## 两种模糊匹配

正则的的强大之处就是在于它可以实现模糊匹配，在模糊匹配上可以分为两个方向：横向模糊和纵向模糊。

```javascript
const reg = /hello/;
reg.test("helloo"); // true
```

### 横向模糊匹配

横向模糊指的是，一个正则可匹配的字符串的长度不是固定的，可以是多种情况的。  
其实现的方式是使用量词。譬如 {m,n}，表示连续出现最少 m 次，最多 n 次。

`/ab{2,5}c/`: 的含义是第一个字符是 a，第二个字符是 b，b 最少出现 2 次最多出现 5 次，第三个字符是 c

```javascript
const regex = /ab{2,5}c/g;
const string = "abc abbc abbbc abbbbc abbbbbc abbbbbbc";

string.match(regex);
// ["abbc", "abbbc", "abbbbc", "abbbbbc"]
```

### 纵向模糊匹配

纵向模糊指的是，一个正则匹配的字符串，具体到某一位字符时，它可以不是某个确定的字符，可以有多种 可能。
其实现的方式是使用字符组。譬如 [abc]，表示该字符是可以字符 "a"、"b"、"c" 中的任何一个。

`/a[123]b/`: 可以匹配如下三种字符串: "a1b"、"a2b"、"a3b"。

```javascript
var regex = /a[123]b/g;
var string = "a0b a1b a2b a3b a4b";
string.match(regex);
// ["a1b", "a2b", "a3b"]
```

## 字符组

:::tip
需要强调的是，虽叫字符组(字符类)，但只是其中一个字符。
例如 [abc]，表示匹配一个字符，它可以是 "a"、"b"、"c" 之一。
:::

### 范围表示法

`[1234567abcdefgABCDERG]`可以表示位`[1-7a-gA-G]`

```javascript
const reg = /[1-9]/;
reg.test("asd"); // false
reg.test("a1sd"); // true
```

> 因为`-`有特殊用途，所以要是想表示`-`字符串的话，可以使用`\-`反斜杠转义

```javascript
const reg = /[1-9\-]/;
reg.test("asd"); // false
reg.test("asd-"); // true
```

可以写成如下的方式:[-az] 或 [az-] 或 [a\-z]。 即要么放在开头，要么放在结尾，要么转义。总之不会让引擎认为是范围表示法就行了。

### 排除字符组

某位字符可以是任何东西，但就不能是 "a"、"b"、"c"。  
`[^abc]`:排除`a` `b` `c`

字符组的第一位放 ^(脱字符)，表示求反的概念。

```javascript
/[^abc]/.test("asd"); // true
/[^abc]/.test("a"); // false
```

### 常见的简写形式

| 字符组                                                                     | 含义                                                                                          |
| -------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| \d                                                                         | 表示 [0-9]。表示是一位数字。 记忆方式:其英文是 digit(数字)                                    |
| \D                                                                         | 表示 [^0-9]。表示除数字外的任意字符。                                                         |
| \w                                                                         | 表示 [0-9a-zA-Z_]。表示数字、大小写字母和下划线。 记忆方式:w 是 word 的简写，也称单词字符。   |
| \W                                                                         | 表示 [^0-9a-za-z_]。非单词字符。                                                              |
| \s                                                                         | 表示 [ \t\v\n\r\f]。表示空白符，包括空格、水平制表符、垂直制表符、换行符、回车符、换页 符。   |
| 记忆方式:s 是 space 的首字母，空白符的单词是 white space。                 |
| \S                                                                         | 表示 [^ \t\v\n\r\f]。 非空白符。                                                              |
| .                                                                          | 表示 [^\n\r\u2028\u2029]。通配符，表示几乎任意字符。换行符、回车符、行分隔符和段分隔符 除外。 |
| 记忆方式:想想省略号 ... 中的每个点，都可以理解成占位符，表示任何类似的东西 |

表示任意字符串，可以使用 [\d\D]、[\w\W]、[\s\S] 和 [^] 中任何的一个。

## 量词

量词也称重复。掌握 {m,n} 的准确含义后，只需要记住一些简写形式。

### 量词简写

| 量词 | 含义                                                                                                                  |
| ---- | --------------------------------------------------------------------------------------------------------------------- |
| {m,} | 表示至少出现 m 次。                                                                                                   |
| {m}  | 等价于 {m,m}，表示出现 m 次。                                                                                         |
| ?    | 等价于 {0,1}，表示出现或者不出现。 记忆方式:问号的意思表示，有吗?                                                     |
| +    | 等价于 {1,}，表示出现至少一次。 记忆方式:加号是追加的意思，得先有一个，然后才考虑追加。                               |
| \*   | 等价于 {0,}，表示出现任意次，有可能不出现。 记忆方式:看看天上的星星，可能一颗没有，可能零散有几颗，可能数也数不过来。 |

```javascript
/b{1,3}/.test("ab"); // true
```

### 贪婪匹配与惰性匹配

贪婪匹配

```javascript
"123 1234 12345 123456".match(/\d{2,5}/g);
// ["123", "1234", "12345", "12345"]
```

惰性匹配

```javascript
"123 1234 12345 123456".match(/\d{2,5}?/g);
// ["12", "12", "34", "12", "34", "12", "34", "56"]
```

其中 /\d{2,5}?/ 表示，虽然 2 到 5 次都行，当 2 个就够的时候，就不再往下尝试了。

通过在量词后面加个问号就能实现惰性匹配

| 惰性匹配 | 贪婪匹配 |
| -------- | -------- |
| {m,n}?   | {m,n}    |
| {m,}?    | {m,}     |
| ??       | ??       |
| +?       | +        |
| \*?      | \*       |

## 多选分支

(p1|p2|p3)，其中 p1、p2 和 p3 是子模式，用 |(管道符)分隔，表示其中任何之一

```javascript
"good idea, nice try.".match(/good|nice/g);
// ["good", "nice"]
```

注意一下两种场景

比如我用 /good|goodbye/，去匹配 "goodbye" 字符串时，结果是 "good"

```javascript
"goodbye".match(/good|goodbye/g);
// ["good"]
```

而把正则改成 /goodbye|good/，结果是:

```javascript
"goodbye".match(/goodbye|good/g);
// ["goodbye"]
```

:::tip
分支结构也是惰性的，即当前面的匹配上了，后面的就不再尝试了。
:::

## 案例分析

### 十六进制色值

要求匹配：

```
#ffbbad
#Fc01DF
#FFF
#ffE
```

分析：

- 以#开头
- 后面紧跟 [0-9a-fA-F]，次数是 3 次或者 6 次
- 需要用到量词和分支解构

```javascript
/#([1-9a-zA-Z]{3}|[0-9a-zA-Z]{6})$/.test("#ffff");
```

### 匹配时间

要求匹配

```
23:59
02:07
```

分析

- 共四位数字和：组成
- 第一位是[012]，第二位[0-9]，但是注意当第一位是[2]时第二位[0-3]
- 第三位是[0-5]，第四位是[0-9]

```javascript
/^([01][0-9]|[2][0-3]):[0-5][0-9]$/.test("02:07");
```

:::tip
`^`: 从头开始匹配（正则 "^abc" 可以匹配"abcd" 但不能匹配"dabc"）  
`$`: 正则最后一个字符必须在字符串结尾  
同时有^和$表示必须匹配整个字符串如正则"^abc$"匹配字符串"abc"，但不能匹配"abcd"
:::

### 匹配日期

要求匹配

```
2017-06-10
```

分析

- 年：四位数字组成[0-9]{4}
- 月：0[1-9]|1[0-2]
- 日：0[1-9]|2[0-9]|3[01]

```javascript
/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[01])$/.test("2017-06-10");
```

### window 操作系统文件路径

要求匹配

```
F:\study\javascript\regex\regular expression.pdf
F:\study\javascript\regex\
F:\study\javascript
F:\
```

分析

```
盘符:\文件夹\文件夹\文件夹\
```

- 匹配磁盘`f:\`需要使用 `[a-zA-Z]:\\`，不区分大小写，注意`\`需要转义`\\`
- 文件名称中不能有的特殊字符`[^\\:*<>|"?\r\n/]`
  - `\\` 转义`\`
  - `\r` 回车符
  - `\n` 换行符
  - 其他都是代表字符表面意思
- 名称不能为空，至少包含一个字符，所以要使用量词 `+` , `[^\\:*<>|"?\r\n/]+`
- 文件夹后必须要跟\， `[^\\:*<>|"?\r\n/]+\\`
- `f:\`,允许文件不存在的情况，所以使用量词*，不限制出现次数，`([^\\:*<>|"?\r\n/]+\\)\*`
- 最后一个可能是文件，所以最后一个有可能是不带`\`，所以添加`([^\\:*<>|"?\r\n/]+)？`

```javascript
/^[a-zA-Z]:\\([^\\:*<>|"?\r\n/]+\\)*([^\\:*<>|"?\r\n/]+)?$/.test(
  `F:\\study\\javascript\\regex\\asdasd.asd`
);
```

:::tip
在 JavaScript 中字符串要表示字符 \ 时，也需要转义。
:::

### 匹配 id

要求匹配：从下面的 html 中提取出 id="container"

```
<div id="container" class="main"></div>
```

分析

- 匹配 id="到"内容
- `.`是通配符，查找单个字符，除了换行和行结束符。`.*`
- 但是 \* 又是贪婪的，当遇到 container 后面双引号时，是不会 停下来，会继续匹配，直到遇到最后一个双引号为止。实际匹配结果是 `id="container" class="main"`
- 解决贪婪匹配问题，`.*?`

```javascript
'<div id="container" class="main"></div>'.match(/id=".*?"/)
// ["id="container"", index: 5, input: "<div id="container" class="main"></div>", groups: undefined]
'<div id="container" class="main"></div>'.match(/id="(.*?)"/)
// ["id="container"", "container", index: 5, input: "<div id="container" class="main"></div>", groups: undefined]
```

:::tip
match方法结果返回是数组，数组的长度是有正则的个数决定的，就是（），后面会写到
:::
